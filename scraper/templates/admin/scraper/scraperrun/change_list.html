{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'admin/css/scraper-theme.css' %}">
<script>
function startScraper(button) {
    if (!confirm('Are you sure you want to start the permit scraper? This will collect data from all cities and save to the database.')) {
        return false;
    }
    
    // Disable button and show loading state
    button.style.opacity = '0.6';
    button.style.pointerEvents = 'none';
    button.innerHTML = '⏳ Running Scraper...';
    
    // Show loading message
    const controlPanel = document.querySelector('.scraper-control-panel');
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'scraper-loading';
    loadingDiv.innerHTML = `
        <div style="background: #e3f2fd; border: 2px solid #2196f3; border-radius: 8px; padding: 15px; margin: 10px 0;">
            <strong>🚀 Scraper is running...</strong><br>
            <em>This may take a few moments. Please wait for completion.</em>
        </div>
    `;
    controlPanel.appendChild(loadingDiv);
    
    return true;
}
</script>
{% endblock %}

{% block content_title %}
    <h1>Scraper Runs</h1>
    
    <div class="scraper-control-panel">
        <h3>🏢 Permit Scraper Control Panel</h3>
        <p>Execute the permit scraper directly from this page. Results will be displayed here and saved to the database.</p>
        
        <a href="start-scraper/" 
           class="scraper-btn scraper-btn-primary"
           onclick="return startScraper(this);">
            🚀 Start Permit Scraper
        </a>
        
        <a href="../permit/" 
           class="scraper-btn scraper-btn-secondary">
            📋 View All Permits
        </a>
        
        <a href="/api/scraper/dashboard/" target="_blank"
           class="scraper-btn scraper-btn-info">
            📊 API Dashboard
        </a>
    </div>
{% endblock %}

{% block result_list %}
    <div style="margin-bottom: 20px;">
        <h3>Recent Scraper Runs</h3>
        <p style="color: #666;">Track all permit scraper executions and their results.</p>
    </div>
    {{ block.super }}
{% endblock %}